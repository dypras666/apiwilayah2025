<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo API Wilayah Indonesia</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .content {
            padding: 30px;
        }
        
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .demo-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        select, input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #5a6fd8;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .result pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .loading {
            text-align: center;
            color: #667eea;
            font-style: italic;
        }
        
        .error {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 5px;
        }
        
        .success {
            color: #155724;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 10px;
            border-radius: 5px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üáÆüá© Demo API Wilayah Indonesia</h1>
            <p>PHP 8 Version - Interactive Demo</p>
        </div>
        
        <div class="content">
            <div class="grid">
                <div class="demo-section">
                    <h3>1. Pilih Provinsi</h3>
                    <div class="form-group">
                        <label for="province-select">Provinsi:</label>
                        <select id="province-select">
                            <option value="">-- Pilih Provinsi --</option>
                        </select>
                    </div>
                    <button onclick="loadProvinces()">Load Provinsi</button>
                    <div id="province-result" class="result" style="display:none;"></div>
                </div>
                
                <div class="demo-section">
                    <h3>2. Pilih Kabupaten/Kota</h3>
                    <div class="form-group">
                        <label for="regency-select">Kabupaten/Kota:</label>
                        <select id="regency-select" disabled>
                            <option value="">-- Pilih Provinsi Dulu --</option>
                        </select>
                    </div>
                    <button onclick="loadRegencies()" id="regency-btn" disabled>Load Kabupaten/Kota</button>
                    <div id="regency-result" class="result" style="display:none;"></div>
                </div>
                
                <div class="demo-section">
                    <h3>3. Pilih Kecamatan</h3>
                    <div class="form-group">
                        <label for="district-select">Kecamatan:</label>
                        <select id="district-select" disabled>
                            <option value="">-- Pilih Kabupaten Dulu --</option>
                        </select>
                    </div>
                    <button onclick="loadDistricts()" id="district-btn" disabled>Load Kecamatan</button>
                    <div id="district-result" class="result" style="display:none;"></div>
                </div>
                
                <div class="demo-section">
                    <h3>4. Pilih Desa/Kelurahan</h3>
                    <div class="form-group">
                        <label for="village-select">Desa/Kelurahan:</label>
                        <select id="village-select" disabled>
                            <option value="">-- Pilih Kecamatan Dulu --</option>
                        </select>
                    </div>
                    <button onclick="loadVillages()" id="village-btn" disabled>Load Desa/Kelurahan</button>
                    <div id="village-result" class="result" style="display:none;"></div>
                </div>
            </div>
            
            <div class="demo-section">
                <h3>üîç Test Custom Endpoint</h3>
                <div class="form-group">
                    <label for="custom-endpoint">Endpoint:</label>
                    <input type="text" id="custom-endpoint" placeholder="/api/wilayah/provinces" value="/api/wilayah/provinces">
                </div>
                <button onclick="testCustomEndpoint()">Test Endpoint</button>
                <div id="custom-result" class="result" style="display:none;"></div>
            </div>
        </div>
    </div>
    
    <script>
        const baseUrl = window.location.origin + window.location.pathname.replace('/demo.html', '');
        
        // Load provinces on page load
        window.onload = function() {
            loadProvinces();
        };
        
        async function apiCall(endpoint) {
            try {
                const response = await fetch(baseUrl + endpoint);
                const data = await response.json();
                return data;
            } catch (error) {
                throw new Error('Network error: ' + error.message);
            }
        }
        
        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            
            if (isError) {
                element.innerHTML = `<div class="error">${data}</div>`;
            } else {
                element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            }
        }
        
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML = '<div class="loading">Loading...</div>';
        }
        
        async function loadProvinces() {
            showLoading('province-result');
            
            try {
                const data = await apiCall('/api/wilayah/provinces');
                showResult('province-result', data);
                
                // Populate province select
                const select = document.getElementById('province-select');
                select.innerHTML = '<option value="">-- Pilih Provinsi --</option>';
                
                if (data.data) {
                    data.data.forEach(province => {
                        const option = document.createElement('option');
                        option.value = province.id;
                        option.textContent = province.name;
                        select.appendChild(option);
                    });
                }
                
                select.onchange = function() {
                    if (this.value) {
                        document.getElementById('regency-select').disabled = false;
                        document.getElementById('regency-btn').disabled = false;
                        loadRegencies();
                    } else {
                        resetSelects(['regency', 'district', 'village']);
                    }
                };
                
            } catch (error) {
                showResult('province-result', error.message, true);
            }
        }
        
        async function loadRegencies() {
            const provinceId = document.getElementById('province-select').value;
            if (!provinceId) return;
            
            showLoading('regency-result');
            
            try {
                const data = await apiCall(`/api/wilayah/provinces/${provinceId}/regencies`);
                showResult('regency-result', data);
                
                // Populate regency select
                const select = document.getElementById('regency-select');
                select.innerHTML = '<option value="">-- Pilih Kabupaten/Kota --</option>';
                
                if (data.data) {
                    data.data.forEach(regency => {
                        const option = document.createElement('option');
                        option.value = regency.id;
                        option.textContent = regency.name;
                        select.appendChild(option);
                    });
                }
                
                select.onchange = function() {
                    if (this.value) {
                        document.getElementById('district-select').disabled = false;
                        document.getElementById('district-btn').disabled = false;
                        loadDistricts();
                    } else {
                        resetSelects(['district', 'village']);
                    }
                };
                
            } catch (error) {
                showResult('regency-result', error.message, true);
            }
        }
        
        async function loadDistricts() {
            const regencyId = document.getElementById('regency-select').value;
            if (!regencyId) return;
            
            showLoading('district-result');
            
            try {
                const data = await apiCall(`/api/wilayah/regencies/${regencyId}/districts`);
                showResult('district-result', data);
                
                // Populate district select
                const select = document.getElementById('district-select');
                select.innerHTML = '<option value="">-- Pilih Kecamatan --</option>';
                
                if (data.data) {
                    data.data.forEach(district => {
                        const option = document.createElement('option');
                        option.value = district.id;
                        option.textContent = district.name;
                        select.appendChild(option);
                    });
                }
                
                select.onchange = function() {
                    if (this.value) {
                        document.getElementById('village-select').disabled = false;
                        document.getElementById('village-btn').disabled = false;
                        loadVillages();
                    } else {
                        resetSelects(['village']);
                    }
                };
                
            } catch (error) {
                showResult('district-result', error.message, true);
            }
        }
        
        async function loadVillages() {
            const districtId = document.getElementById('district-select').value;
            if (!districtId) return;
            
            showLoading('village-result');
            
            try {
                const data = await apiCall(`/api/wilayah/districts/${districtId}/villages`);
                showResult('village-result', data);
                
                // Populate village select
                const select = document.getElementById('village-select');
                select.innerHTML = '<option value="">-- Pilih Desa/Kelurahan --</option>';
                
                if (data.data) {
                    data.data.forEach(village => {
                        const option = document.createElement('option');
                        option.value = village.id;
                        option.textContent = village.name;
                        select.appendChild(option);
                    });
                }
                
            } catch (error) {
                showResult('village-result', error.message, true);
            }
        }
        
        async function testCustomEndpoint() {
            const endpoint = document.getElementById('custom-endpoint').value;
            if (!endpoint) return;
            
            showLoading('custom-result');
            
            try {
                const data = await apiCall(endpoint);
                showResult('custom-result', data);
            } catch (error) {
                showResult('custom-result', error.message, true);
            }
        }
        
        function resetSelects(types) {
            types.forEach(type => {
                const select = document.getElementById(`${type}-select`);
                const btn = document.getElementById(`${type}-btn`);
                const result = document.getElementById(`${type}-result`);
                
                select.innerHTML = `<option value="">-- Pilih ${type === 'regency' ? 'Provinsi' : type === 'district' ? 'Kabupaten' : 'Kecamatan'} Dulu --</option>`;
                select.disabled = true;
                btn.disabled = true;
                result.style.display = 'none';
            });
        }
    </script>
</body>
</html>